{% from "macros/_filters.jinja" import select_filter, text_filter, button_row with context %}
{% from "macros/_modals.jinja" import confirm_modal with context %}

<div class="card-header bg-white">
    <form method="get" class="p-3 mb-4">
        <div class="row g-3 align-items-end">

            {{ text_filter('Hledat hráče', 'filter-q', 'q', q,
                placeholder='Jméno studenta nebo hráče...') }}

            {{ select_filter('Nástroj žadatele', 'filter-instrument', 'instrument_ids',
                instruments, instrument_filter, placeholder='Vyberte nástroj...', multiple=True) }}

            {{ select_filter('Status žádosti', 'filter-status', 'status',
                [
                    {'id': '', 'name': 'Všechny'},
                    {'id': 'pending', 'name': 'Čeká na vyřízení'},
                    {'id': 'approved', 'name': 'Schválené'},
                    {'id': 'rejected', 'name': 'Zamítnuté'}
                ],
                [status_filter] if status_filter else [], multiple=False, placeholder='Vyberte status') }}

            {# Optional: Health filter (commented out by default) #}
            {#
            {{ select_filter('Health check', 'filter-health', 'health',
                [
                    {'id': '', 'name': 'Všechny'},
                    {'id': 'ok', 'name': 'OK'},
                    {'id': 'minimum', 'name': 'Minimum hráčů nesplněno'},
                    {'id': 'guests', 'name': 'Příliš hostů'}
                ],
                [health_filter] if health_filter else [], multiple=False, placeholder='Vyberte stav') }}
            #}

            {{ button_row(show_reset=(q or instrument_filter or status_filter or health_filter),
                          reset_url=url_for('chamber_applications.index')) }}

            {% if current_user.has_permission('app_decline_all_unresolved') %}
                <div class="col-auto">
                    <button type="button"
                            class="btn btn-outline-danger btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#RejectAllApplicationsModal">
                        <i class="fas fa-circle-xmark"></i> Zamítnout nevyřízené
                    </button>
                </div>
            {% endif %}
        </div>
    </form>

    {% include "partials/_tomselect_init.html" %}
</div>

{% if current_user.has_permission('app_decline_all_unresolved') %}
    {{ confirm_modal(
        id='RejectAllApplicationsModal',
        title='Zamítnout nevyřízené žádosti',
        message='Opravdu si přejete zamítnout všechny zbývající nevyřízené žádosti?',
        action_url=url_for('chamber_applications.reject_all'),
        button_label='Zamítnout',
        button_class='danger',
        icon='circle-xmark'
    ) }}
{% endif %}


