{% extends 'pdf_export/pdf_base.html' %}
{% set title = 'Přehled komorních souborů' %}
{% block head %}
    <style>

        .ok {
            color: #198754;
            font-weight: bold;
        }

        .bad {
            color: #dc3545;
            font-weight: bold;
        }

        .exc {
            color: #17a2b8;
            font-weight: bold;
        }

        .no-ensembles {
            color: #666;
            font-style: italic;
        }
    </style>
{% endblock %}

{% block content %}
    <!-- Filters -->
    {% if filters %}
        <div style="font-size: 9pt; margin-bottom: 15px;">
        <span style="color: #555;">
        {% set parts = [] %}

            {% if filters.instrument_names %}
                {% set _ = parts.append("Nástroje: " + (filters.instrument_names | join(", "))) %}
            {% endif %}

            {% if filters.teacher_names %}
                {% set _ = parts.append("Pedagogové: " + (filters.teacher_names | join(", "))) %}
            {% endif %}

            {% if filters.department_names %}
                {% set _ = parts.append("Katedry: " + (filters.department_names | join(", "))) %}
            {% endif %}

            {% if filters.search_query %}
                {% set _ = parts.append("Hledání: „" + filters.search_query + "“") %}
            {% endif %}

            {% if filters.incomplete_filter %}
                {% set _ = parts.append("Kompletnost: " + ("Nekompletní" if filters.incomplete_filter == "1" else "Kompletní")) %}
            {% endif %}

            {% if filters.health_filter %}
                {% set _ = parts.append("Stav: " + filters.health_filter) %}
            {% endif %}

            {% if parts %}
                {{ parts | join("; ") }}
            {% endif %}
    </span>
        </div>
    {% endif %}

    <!-- Main table -->
    <table>
        <thead>
        <tr>
            <th>Soubor</th>
            <th>Instrumentace</th>
            <th>Členové</th>
        </tr>
        </thead>
        <tbody>
        {% for ens in ensembles %}
            {% set eps = ens.player_links_for_semester(current_semester.id) %}
            <tr>
                <td><b>{{ ens.name }}</b></td>
                <td>{{ ens.instrumentation }}</td>
                <td>
                    {% if eps %}
                        {% for ep in eps %}
                            {% set p = ep.player %}
                            {% set instr = ep.ensemble_instrumentation.instrument if ep.ensemble_instrumentation else None %}

                            {% if p %}
                                <em>{{ (instr.abbreviation if instr else (p.instrument.abbreviation if p.instrument else '–')) }}. </em>
                                {{ p.first_name[0] }}. {{ p.last_name }}
                            {% else %}
                                <em>{{ instr.abbreviation if instr else '–' }}. </em>
                                <span class="no-ensembles">Neobsazeno</span>
                            {% endif %}

                            {% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        <span class="no-ensembles">–</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>


{% endblock %}