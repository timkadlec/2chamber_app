{% extends 'pdf_export/pdf_base.html' %}
{% set title = "Přehled komorních souborů a jejich pedagogů" %}
{% block head %}
    <style>
        .hours {
            width: 70px;
            text-align: center;
            white-space: nowrap;
        }

        .no-ensembles {
            color: #666;
            font-style: italic;
        }

        .teacher-section {
            page-break-inside: avoid;
            margin-bottom: 0.6em;
        }
    </style>
{% endblock %}

{% block content %}

    {% for teacher in teachers %}
        {% set rows = teacher.pdf_rows if teacher.pdf_rows is defined else [] %}

        <section class="teacher-section">
            <h2>{{ teacher.full_name }}</h2>

            {% if rows %}
                <table>
                    <thead>
                    <tr>
                        <th>Soubor</th>
                        <th>Členové</th>
                        <th class="hours">Hodinová dotace</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for link in rows %}
                        {% set ens = link.ensemble %}
                        {% set eps = ens.player_links_for_semester(current_semester.id) %}
                        <tr>
                            <td><b>{{ ens.name }}</b></td>
                            <td>
                                {% if eps %}
                                    {% for ep in eps %}
                                        {% set p = ep.player %}
                                        {% set instr = ep.ensemble_instrumentation.instrument if ep.ensemble_instrumentation else None %}

                                        {% if p %}
                                            <em>{{ (instr.abbreviation if instr else (p.instrument.abbreviation if p.instrument else '–')) }}.</em>
                                            {{ p.last_name }} {{ p.first_name[0] }}
                                        {% else %}
                                            <em>{{ instr.abbreviation if instr else '–' }}.</em>
                                            <span class="no-ensembles">Neobsazeno</span>
                                        {% endif %}

                                        {% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <span class="no-ensembles">–</span>
                                {% endif %}
                            </td>
                            <td class="hours">{{ "%.1f"|format(link.hour_donation or 0) }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="no-ensembles">Žádné soubory v tomto semestru.</p>
            {% endif %}
        </section>
    {% endfor %}

{% endblock %}
