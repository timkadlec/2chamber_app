{% extends 'pdf_export/pdf_base.html' %}
{% set title = "Přehled komorních souborů a jejich pedagogů" %}
{% block head %}
    <style>

        .hours {
            width: 70px;
            text-align: center;
            white-space: nowrap;
        }

        .no-ensembles {
            color: #666;
            font-style: italic;
        }

        .teacher-section {
            page-break-inside: avoid;
            margin-bottom: 0.6em;
        }
    </style>

{% endblock %}
{% block content %}


    {% for teacher in teachers %}
        {% set ensemb_links = teacher.ensemble_links | selectattr("semester_id", "equalto", current_semester.id) | list %}
        <section class="teacher-section">
            <h2>{{ teacher.full_name }}</h2>
            {% if ensemb_links %}
                <table>
                    <thead>
                    <tr>
                        <th>Soubor</th>
                        <th>Členové</th>
                        <th class="hours">Hodinová dotace</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for link in ensemb_links %}
                        {% set ens = link.ensemble %}
                        <tr>
                            <td><b>{{ ens.name }}</b></td>
                            <td>
                                {% for pl in ens.player_links if pl.player %}
                                    <em>{{ pl.player.instrument.abbreviation }}.</em> {{ pl.player.last_name }}
                                    {{ pl.player.first_name[0] }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </td>
                            <td class="hours">{{ "%.1f"|format(link.hour_donation or 0) }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="no-ensembles">Žádné soubory v tomto semestru.</p>
            {% endif %}
        </section>
    {% endfor %}

{% endblock %}
