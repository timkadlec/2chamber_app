{% extends "base.html" %}
{% block title %}Protokol o výjimce #{{ exception.id }}{% endblock %}

{% block content %}
    <main class="py-4">
        <div class="container-xl">

            {% from "macros/_back_button.html" import back_link %}
            {{ back_link("exceptions.index", "Zpět na výjimky", request.args) }}
            <div class="card shadow-sm">
                <div class="card-header text-center">
                    <h4 class="mb-0 fw-bold">Akademie múzických umění v Praze</h4>
                    <small class="text-muted">Protokol o výjimce v rámci předmětu Komorní hra</small>
                </div>

                <div class="card-body p-5">
                    <!-- Document heading -->
                    <h5 class="text-center mb-4 text-uppercase">Oficiální protokol</h5>

                    <!-- Exception Metadata -->
                    <table class="table table-borderless mb-4">
                        <tr>
                            <th style="width:30%">Číslo výjimky:</th>
                            <td>#{{ exception.id }}</td>
                        </tr>
                        <tr>
                            <th>Žádost:</th>
                            <td>Žádost č. {{ exception.application.id }}</td>
                        </tr>
                        <tr>
                            <th>Datum podání:</th>
                            <td>{{ exception.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
                        </tr>
                        <tr>
                            <th>Podal:</th>
                            <td>{{ exception.created_by.display_name if exception.created_by else "—" }}</td>
                        </tr>
                        <tr>
                            <th>Stav:</th>
                            <td>
                                {% if exception.status == 'pending' %}Čeká na schválení{% endif %}
                                {% if exception.status == 'approved' %}Schváleno{% endif %}
                                {% if exception.status == 'rejected' %}Zamítnuto{% endif %}
                            </td>
                        </tr>
                    </table>

                    <!-- Reason -->
                    <h6 class="fw-bold mt-4">Odůvodnění žadatele:</h6>
                    <p class="border rounded p-3 bg-light">{{ exception.reason }}</p>

                    <!-- Reviewer statement -->
                    {% if exception.reviewed_by %}
                        <h6 class="fw-bold mt-4">Vyjádření posuzovatele:</h6>
                        <div class="border rounded p-4 bg-white">
                            <p>
                                Na základě posouzení žádosti č. {{ exception.application.id }},
                                podané dne {{ exception.created_at.strftime("%d.%m.%Y %H:%M") }}
                                žadatelem {{ exception.created_by.display_name if exception.created_by else "—" }},
                                rozhodl posuzovatel dne {{ exception.reviewed_at.strftime("%d.%m.%Y %H:%M") }}
                                následovně:
                            </p>

                            <p>
                                Žádost o výjimku se
                                <strong>
                                    {% if exception.status == 'approved' %}
                                        schvaluje{% elif exception.status == 'rejected' %}zamítá{% endif %}
                                </strong>.
                            </p>

                            {% if exception.reviewer_comment %}
                                <p><strong>Komentář posuzovatele:</strong><br>
                                    {{ exception.reviewer_comment }}
                                </p>
                            {% endif %}

                            <p class="mt-3"><em>Posuzoval: {{ exception.reviewed_by.display_name }}</em></p>
                        </div>
                    {% else %}
                        <p class="text-muted mt-4"><em>Tato žádost zatím nebyla posouzena.</em></p>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>
{% endblock %}
