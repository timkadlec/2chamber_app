{% extends 'base.html' %}

{% block title %}
    Pedagogové
{% endblock %}

{% block content %}
<main>
    <div class="container-xl pb-4">
        <h1 class="text-secondary">Pedagogové</h1>
        <p>Přehled pedagogů na aktuálně vybraný semestr.</p>
    </div>

    <div class="container-xl pb-2">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="{{ url_for('teachers.index') }}">
                    Pedagogové
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('teachers.workloads') }}">
                    Úvazky
                </a>
            </li>
        </ul>
    </div>

    <div class="container-xl">
        <div class="card shadow-sm mb-4">
            <div class="card-body">

                {% if teachers %}
                    <div class="row g-3">
                        {% for teacher in teachers %}
                            {% set full_name = (teacher.full_name or ((teacher.first_name or '') ~ ' ' ~ (teacher.last_name or ''))).strip() %}
                            {% set initials = ((teacher.first_name or '')[:1] ~ (teacher.last_name or '')[:1]).upper() %}
                            {% set detail_url = url_for('teachers.teacher_detail', teacher_id=teacher.id) %}
                            {% set photo_url = url_for('api.api_get_teacher_photo', teacher_id=teacher.id) %}

                            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                                <a href="{{ detail_url }}" class="text-decoration-none">
                                    <div class="d-flex flex-column align-items-center p-2 rounded-3 border h-100"
                                         style="background: #fff;">
                                        <!-- Avatar -->
                                        <div class="rounded-circle overflow-hidden d-flex align-items-center justify-content-center"
                                             style="width: 86px; height: 86px; border: 1px solid rgba(0,0,0,.1); background: #f3f4f6;">
                                            {# Try loading photo; fallback to initials if image fails #}
                                            <img src="{{ photo_url }}"
                                                 alt="{{ full_name }}"
                                                 style="width: 100%; height: 100%; object-fit: cover; display: block;"
                                                 onerror="this.style.display='none'; this.parentElement.querySelector('.avatar-fallback').style.display='flex';">
                                            <div class="avatar-fallback text-secondary fw-semibold"
                                                 style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; font-size: 22px;">
                                                {{ initials if initials|length else "?" }}
                                            </div>
                                        </div>

                                        <!-- Name -->
                                        <div class="mt-2 text-center">
                                            <div class="fw-semibold text-dark" style="line-height: 1.15;">
                                                {{ teacher.last_name }}
                                            </div>
                                            <div class="text-muted small" style="line-height: 1.15;">
                                                {{ teacher.first_name }}
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-muted">
                        Žádní pedagogové v aktuálním semestru.
                    </div>
                {% endif %}

            </div>
        </div>
    </div>
</main>
{% endblock %}
